!function(){function t(t,e,i,n){Object.defineProperty(t,e,{get:i,set:n,enumerable:!0,configurable:!0})}var e,i,n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o={},r={},a=n.parcelRequirea202;null==a&&((a=function(t){if(t in o)return o[t].exports;if(t in r){var e=r[t];delete r[t];var i={id:t,exports:{}};return o[t]=i,e.call(i.exports,i,i.exports),i.exports}var n=Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(t,e){r[t]=e},n.parcelRequirea202=a);var s=a.register;function l(t,e,i){if(!e.has(t))throw TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}function c(t,e){var i;return(i=l(t,e,"get")).get?i.get.call(t):i.value}function d(t,e){if(e.has(t))throw TypeError("Cannot initialize the same private elements twice on an object")}function u(t,e,i){d(t,e),e.set(t,i)}function h(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw TypeError("attempted to set read only private field");e.value=i}}(t,l(t,e,"set"),i),i}function m(t,e,i){if(!e.has(t))throw TypeError("attempted to get private field on non-instance");return i}function p(t,e){d(t,e),e.add(t)}s("iE7OH",function(e,i){t(e.exports,"register",function(){return n},function(t){return n=t}),t(e.exports,"resolve",function(){return o},function(t){return o=t});var n,o,r=new Map;n=function(t,e){for(var i=0;i<e.length-1;i+=2)r.set(e[i],{baseUrl:t,path:e[i+1]})},o=function(t){var e=r.get(t);if(null==e)throw Error("Could not resolve bundle with id "+t);return new URL(e.path,e.baseUrl).toString()}}),s("aNJCr",function(e,i){t(e.exports,"getBundleURL",function(){return n},function(t){return n=t});var n,o={};n=function(t){var e=o[t];return e||(e=function(){try{throw Error()}catch(e){var t=(""+e.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(t)return(""+t[2]).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}return"/"}(),o[t]=e),e}}),s("3c8ZQ",function(t,e){t.exports=a("4WKyX")(a("iE7OH").resolve("Oreqb")).then(()=>a("dZsGG"))}),s("4WKyX",function(t,e){var i=a("2prpb");t.exports=i(function(t){return new Promise(function(e,i){if([].concat(document.getElementsByTagName("script")).some(function(e){return e.src===t})){e();return}var n=document.createElement("link");n.href=t,n.rel="preload",n.as="script",document.head.appendChild(n);var o=document.createElement("script");o.async=!0,o.type="text/javascript",o.src=t,o.onerror=function(e){var n=TypeError("Failed to fetch dynamically imported module: ".concat(t,". Error: ").concat(e.message));o.onerror=o.onload=null,o.remove(),i(n)},o.onload=function(){o.onerror=o.onload=null,e()},document.getElementsByTagName("head")[0].appendChild(o)})})}),s("2prpb",function(t,e){var i={},n={},o={};t.exports=function(t,e){return function(r){var a=function(t){switch(t){case"preload":return n;case"prefetch":return o;default:return i}}(e);return a[r]?a[r]:a[r]=t.apply(null,arguments).catch(function(t){throw delete a[r],t})}}}),a("iE7OH").register(a("aNJCr").getBundleURL("hHmRL"),JSON.parse('["hHmRL","scanner.ade05fc8.js","Oreqb","es.c8e8eed2.js","7PPU8","index.1205d353.js"]')),Object.defineProperty({},"ResizeObserverElement",{get:function(){return C},set:e,enumerable:!0,configurable:!0});let g=document.createElement("template"),f=String.raw;g.innerHTML=f`
  <style>:host { display: contents; }</style>
  <slot></slot>
`;var b=new WeakMap,v=new WeakMap,w=new WeakMap,y=new WeakSet,E=new WeakSet,k=new WeakMap,S=new WeakSet;class C extends HTMLElement{static get observedAttributes(){return["disabled"]}attributeChangedCallback(t,e,i){"disabled"===t&&e!==i&&(this.disabled?m(this,E,x).call(this):m(this,y,z).call(this))}connectedCallback(){m(this,S,A).call(this,"disabled"),"ResizeObserver"in window&&(h(this,v,new ResizeObserver(t=>{this.dispatchEvent(new CustomEvent("resize-observer:resize",{bubbles:!0,composed:!0,detail:{entries:t}}))})),this.disabled||m(this,y,z).call(this),c(this,b).addEventListener("slotchange",c(this,k)))}disconnectedCallback(){m(this,E,x).call(this),c(this,b).removeEventListener("slotchange",c(this,k))}get disabled(){return this.hasAttribute("disabled")}set disabled(t){t?this.setAttribute("disabled",""):this.removeAttribute("disabled")}static defineCustomElement(t="resize-observer"){"undefined"==typeof window||window.customElements.get(t)||window.customElements.define(t,C)}constructor(){super(),p(this,y),p(this,E),p(this,S),u(this,b,{writable:!0,value:void 0}),u(this,v,{writable:!0,value:void 0}),u(this,w,{writable:!0,value:void 0}),u(this,k,{writable:!0,value:()=>{this.disabled||m(this,y,z).call(this)}}),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(g.content.cloneNode(!0))),h(this,b,this.shadowRoot.querySelector("slot")),h(this,v,null),h(this,w,[])}}function z(){c(this,b)&&c(this,v)&&(c(this,w).forEach(t=>c(this,v).unobserve(t)),h(this,w,[]),c(this,b).assignedElements().forEach(t=>{c(this,v).observe(t),c(this,w).push(t)}))}function x(){c(this,v)&&c(this,v).disconnect()}function A(t){if(Object.prototype.hasOwnProperty.call(this,t)){let e=this[t];delete this[t],this[t]=e}}C.defineCustomElement(),Object.defineProperty({},"CapturePhoto",{get:function(){return B},set:void 0,enumerable:!0,configurable:!0});let T=(t,e,i)=>(Number.isNaN(e)&&(e=0),Number.isNaN(i)&&(i=0),Math.min(Math.max(t,Math.min(e,i)),Math.max(e,i))),L="capture-photo",R=`
  :host {
    display: block;
    box-sizing: border-box;
  }

  :host *,
  :host *::before,
  :host *::after {
    box-sizing: inherit;
  }

  :host([hidden]),
  [hidden],
  ::slotted([hidden]) {
    display: none;
  }

  video {
    display: block;
  }

  #output:empty {
    display: none;
  }
`,N=document.createElement("template");N.innerHTML=`
  <style>${R}</style>

  <video part="video" playsinline></video>

  <canvas hidden></canvas>

  <div part="actions-container">
    <slot name="capture-button">
      <button part="capture-button" type="button">
        <slot name="capture-button-content">Capture photo</slot>
      </button>
    </slot>

    <slot name="facing-mode-button" hidden>
      <button part="facing-mode-button" type="button">
        <slot name="facing-mode-button-content">Toggle facing mode</slot>
      </button>
    </slot>

    <slot name="actions"></slot>
  </div>

  <slot></slot>

  <div part="output-container" id="output"></div>
`;class B extends HTMLElement{#t={};#e=null;#i=null;#n=null;#o=null;#r=null;#a=null;#s=null;#l=null;constructor(){super(),this.#t=this.getSupportedConstraints(),this.shadowRoot||this.attachShadow({mode:"open"}).appendChild(N.content.cloneNode(!0))}static get observedAttributes(){return["no-image","facing-mode","camera-resolution","pan","tilt","zoom"]}attributeChangedCallback(t,e,i){if(!this.isConnected)return;let n=this.getTrackCapabilities(),o=this.getTrackSettings();if("no-image"===t&&e!==i&&this.#c(),"facing-mode"===t&&e!==i&&"facingMode"in this.#t){let t=["user","environment"].includes(this.facingMode||"");"facingMode"in o&&t&&(this.stopVideoStream(),this.startVideoStream())}if("camera-resolution"===t&&e!==i&&"string"==typeof this.cameraResolution&&this.cameraResolution.trim().length>0){let[t=0,e=0]=this.cameraResolution.split("x").map(t=>Number(t));if(t>0&&e>0&&"width"in n&&"height"in n){let i=!!(n.width?.min&&n.width?.max)&&t>=n?.width?.min&&t<=n?.width?.max,r=!!(n.height?.min&&n.height?.max)&&e>=n?.height?.min&&e<=n?.height?.max;"width"in o&&"height"in o&&i&&r&&(this.stopVideoStream(),this.startVideoStream())}}if("pan"===t&&e!==i&&"pan"in this.#t){let t=!!("pan"in n&&n.pan?.min&&n.pan?.max)&&this.pan>=n.pan.min&&this.pan<=n.pan.max;"pan"in o&&"number"==typeof this.pan&&t&&this.#d("pan",this.pan)}if("tilt"===t&&e!==i&&"tilt"in this.#t){let t=!!("tilt"in n&&n.tilt?.min&&n.tilt?.max)&&this.tilt>=n.tilt.min&&this.tilt<=n.tilt.max;"tilt"in o&&"number"==typeof this.tilt&&t&&this.#d("tilt",this.tilt)}if("zoom"===t&&e!==i&&"zoom"in this.#t){let t=!!("zoom"in n&&n.zoom?.min&&n.zoom?.max)&&this.zoom>=n.zoom.min&&this.zoom<=n.zoom.max;"zoom"in o&&"number"==typeof this.zoom&&t&&this.#d("zoom",this.zoom)}}connectedCallback(){if(this.#u("autpoPlay"),this.#u("noImage"),this.#u("facingMode"),this.#u("cameraResolution"),this.#u("pan"),this.#u("tilt"),this.#u("zoom"),this.#u("calculateFileSize"),this.#i=this.shadowRoot?.querySelector("canvas")||null,this.#n=this.shadowRoot?.getElementById("output")||null,this.#o=this.shadowRoot?.querySelector("video")||null,this.#r=this.shadowRoot?.querySelector('slot[name="capture-button"]')||null,this.#a=this.#h(),this.#s=this.shadowRoot?.querySelector('slot[name="facing-mode-button"]')||null,this.#l=this.#m(),this.#o?.addEventListener("loadedmetadata",this.#p),this.#r?.addEventListener("slotchange",this.#g),this.#a?.addEventListener("click",this.#f),this.#s?.addEventListener("slotchange",this.#b),this.#l?.addEventListener("click",this.#v),!B.isSupported())return this.dispatchEvent(new CustomEvent(`${L}:error`,{bubbles:!0,composed:!0,detail:{error:{name:"NotSupportedError",message:"Not supported"}}}));this.autoPlay&&this.startVideoStream()}disconnectedCallback(){this.stopVideoStream(),this.#l?.removeEventListener("click",this.#v),this.#a?.removeEventListener("click",this.#f),this.#o?.removeEventListener("canplay",this.#p),this.#r?.removeEventListener("slotchange",this.#g),this.#s?.removeEventListener("slotchange",this.#b)}get autoPlay(){return this.hasAttribute("auto-play")}set autoPlay(t){this.toggleAttribute("auto-play",!!t)}get noImage(){return this.hasAttribute("no-image")}set noImage(t){this.toggleAttribute("no-image",!!t)}get facingMode(){return this.getAttribute("facing-mode")||"user"}set facingMode(t){this.setAttribute("facing-mode",t)}get cameraResolution(){return this.getAttribute("camera-resolution")||""}set cameraResolution(t){this.setAttribute("camera-resolution",t)}get pan(){return Number(this.getAttribute("pan"))||0}set pan(t){this.setAttribute("pan",null!=t?t.toString():t)}get tilt(){return Number(this.getAttribute("tilt"))||0}set tilt(t){this.setAttribute("tilt",null!=t?t.toString():t)}get zoom(){return Number(this.getAttribute("zoom"))||1}set zoom(t){this.setAttribute("zoom",null!=t?t.toString():t)}get loading(){return this.hasAttribute("loading")}get calculateFileSize(){return this.hasAttribute("calculate-file-size")}set calculateFileSize(t){this.toggleAttribute("calculate-file-size",!!t)}#v=t=>{t.preventDefault(),this.loading||(this.facingMode="user"!==this.facingMode&&this.facingMode?"user":"environment")};#f=t=>{t.preventDefault(),this.capture()};#p=t=>{let e=t.target;e.play().then(()=>{this.dispatchEvent(new CustomEvent(`${L}:video-play`,{bubbles:!0,composed:!0,detail:{video:e}}))}).catch(t=>{this.dispatchEvent(new CustomEvent(`${L}:error`,{bubbles:!0,composed:!0,detail:{error:t}}))}).finally(()=>{this.removeAttribute("loading")})};#c(){this.#n&&Array.from(this.#n.childNodes).forEach(t=>t.remove())}#d(t,e){if(!this.#e||!t||!e)return;let[i]=this.#e.getVideoTracks(),n=this.getTrackCapabilities();t in this.getTrackSettings()&&i.applyConstraints({advanced:[{[t]:T(Number(e),n[t]?.min||1,n[t]?.max||1)}]})}#g=t=>{t.target?.name==="capture-button"&&(this.#a?.removeEventListener("click",this.#f),this.#a=this.#h(),this.#a&&(this.#a.addEventListener("click",this.#f),"BUTTON"===this.#a.nodeName||this.#a.hasAttribute("role")||this.#a.setAttribute("role","button")))};#b=t=>{t.target?.name==="facing-mode-button"&&(this.#l?.removeEventListener("click",this.#v),this.#l=this.#m(),this.#l&&(this.#l.addEventListener("click",this.#v),"BUTTON"===this.#l.nodeName||this.#l.hasAttribute("role")||this.#l.setAttribute("role","button")))};#m(){return this.#s&&this.#s.assignedElements({flatten:!0}).find(t=>"BUTTON"===t.nodeName||"facing-mode-button"===t.getAttribute("slot"))||null}#h(){return this.#r&&this.#r.assignedElements({flatten:!0}).find(t=>"BUTTON"===t.nodeName||"capture-button"===t.getAttribute("slot"))||null}#u(t){if(Object.prototype.hasOwnProperty.call(this,t)){let e=this[t];delete this[t],this[t]=e}}async startVideoStream(){if(!B.isSupported()||this.#e)return;this.setAttribute("loading","");let t={video:{facingMode:{ideal:this.facingMode||"user"},pan:!0,tilt:!0,zoom:!0},audio:!1};if("string"==typeof this.cameraResolution&&this.cameraResolution.trim().length>0){let[e=0,i=0]=this.cameraResolution.split("x").map(t=>Number(t));e>0&&i>0&&(t.video.width=e,t.video.height=i)}try{this.#e=await navigator.mediaDevices.getUserMedia(t),this.#o&&(this.#o.srcObject=this.#e),this.#d("pan",this.pan),this.#d("tilt",this.tilt),this.#d("zoom",this.zoom);let e=this.getTrackSettings();"facingMode"in e&&this.#s&&(this.#s.hidden=!1)}catch(t){this.dispatchEvent(new CustomEvent(`${L}:error`,{bubbles:!0,composed:!0,detail:{error:t}}))}finally{this.removeAttribute("loading")}}stopVideoStream(){if(!this.#o||!this.#e)return;let[t]=this.#e.getVideoTracks();t?.stop(),this.#o.srcObject=null,this.#e=null}async capture(){if(!this.loading&&this.#i&&this.#o)try{let t=this.#i.getContext("2d"),e=this.#o.videoWidth,i=this.#o.videoHeight;this.#i.width=e,this.#i.height=i,t?.drawImage(this.#o,0,0,e,i);let n=this.#i.toDataURL("image/png");if("string"==typeof n&&n.includes("data:image")){if(!this.noImage){let t=new Image;t.src=n,t.width=e,t.height=i,t.setAttribute("part","output-image"),this.#c(),this.#n?.appendChild(t)}let t={dataURI:n,width:e,height:i};if(this.calculateFileSize)try{let e=await fetch(n),i=(await e.blob()).size;i&&(t.size=i)}catch(t){}this.dispatchEvent(new CustomEvent(`${L}:success`,{bubbles:!0,composed:!0,detail:t}))}}catch(t){this.dispatchEvent(new CustomEvent(`${L}:error`,{bubbles:!0,composed:!0,detail:{error:t}}))}}getSupportedConstraints(){return B.isSupported()&&navigator.mediaDevices.getSupportedConstraints()||{}}getTrackCapabilities(){if(!this.#e)return{};let[t]=this.#e.getVideoTracks();return t&&"function"==typeof t.getCapabilities&&t.getCapabilities()||{}}getTrackSettings(){if(!this.#e)return{};let[t]=this.#e.getVideoTracks();return t&&"function"==typeof t.getSettings&&t.getSettings()||{}}static isSupported(){return!!navigator.mediaDevices?.getUserMedia}static defineCustomElement(t=L){"undefined"==typeof window||window.customElements.get(t)||window.customElements.define(t,B)}}function M(t){return new Promise(function(e,i){t.oncomplete=t.onsuccess=function(){return e(t.result)},t.onabort=t.onerror=function(){return i(t.error)}})}function O(){if(!i){var t,e,n;t="keyval",(e=indexedDB.open("keyval-store")).onupgradeneeded=function(){return e.result.createObjectStore(t)},n=M(e),i=function(e,i){return n.then(function(n){return i(n.transaction(t,e).objectStore(t))})}}return i}B.defineCustomElement();let I="barcode-scanner/",F="settings",D=async t=>{try{return{value:await function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:O();return e("readonly",function(e){return M(e.get(t))})}(t),error:void 0}}catch(t){return{value:void 0,error:t}}},U=async(t,e)=>{try{return await function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:O();return i("readwrite",function(i){return i.put(e,t),M(i.transaction)})}(t,e),{error:void 0}}catch(t){return{error:t}}},j=async()=>D(I+F),q=async t=>U(I+F,t);var H=a("5Gd8p"),P=a("kkiei"),V=a("6m2hf"),H=a("5Gd8p");let $=async t=>{let e=await (0,V.getDoc)((0,V.doc)(H.db,"products",t));return e.exists()?{id:e.id,...e.data()}:null},W=async(t,e)=>{let i="string"==typeof e?e:e?.name,n={barcode:t,name:i,description:"object"==typeof e&&e?.description||"",imageUrl:"object"==typeof e&&e?.imageUrl||null,category:"object"==typeof e&&e?.category||"uncategorized",createdAt:(0,V.serverTimestamp)(),updatedAt:(0,V.serverTimestamp)()};return await (0,V.setDoc)((0,V.doc)(H.db,"products",t),n),n},_=async(t,e)=>{let i=(0,V.doc)(H.db,"products",t);await (0,V.updateDoc)(i,{...e,updatedAt:(0,V.serverTimestamp)()})};function G(t,e="success"){let i=document.getElementById("toastContainer");if(!i)return;let n=document.createElement("div");n.className=`toast ${e}`,n.textContent=t,i.appendChild(n),setTimeout(()=>n.remove(),3e3)}!async function(){let t;let e=(0,P.getCurrentFridgeCode)();if(!e){window.location.href="index.html";return}let i=document.querySelector("capture-photo"),n=document.getElementById("cameraResults"),o=document.getElementById("scanInstructions"),r=document.getElementById("scanBtn"),s=document.getElementById("scanFrame"),l=document.getElementById("settingsBtn"),c=document.getElementById("settingsDialog"),d=document.forms["settings-form"],u=document.getElementById("productDialog"),h=document.getElementById("productForm"),m=document.getElementById("productBarcode"),p=document.getElementById("productName"),g=document.getElementById("productQuantity"),f=!0,b=null;try{await (0,H.initializeFirebase)(),console.log("Firebase ready")}catch(t){console.error("Firebase init error:",t)}if(!("BarcodeDetector"in window))try{await a("3c8ZQ"),console.log("Using BarcodeDetector polyfill.")}catch(t){return G("Strekkodeskanning støttes ikke i denne nettleseren.","danger")}let v=await window.BarcodeDetector.getSupportedFormats(),w=new window.BarcodeDetector({formats:v}),{value:y={beep:!0,vibrate:!0}}=await j();Object.entries(y).forEach(([t,e])=>{let i=d?.querySelector(`[name="${t}"]`);i&&(i.checked=e)});let E=()=>(b||(b=i?.shadowRoot?.querySelector("video")),b),k=(()=>{let t=new(window.AudioContext||window.webkitAudioContext);return t?async(e,i,n)=>{let{value:o}=await j();if(!o?.beep)return;let r=t.createOscillator(),a=t.createGain();r.connect(a),a.connect(t.destination),a.gain.value=n||.03,r.frequency.value=i||860,r.type="square",r.start(t.currentTime),r.stop(t.currentTime+(e||200)/1e3)}:()=>{}})();async function S(t=100){let{value:e}=await j();if(e?.vibrate&&"function"==typeof navigator.vibrate)try{navigator.vibrate(t)}catch{}}async function C(){o&&(o.hidden=!1);try{let e=E();if(!e||e.readyState<2){f&&(t=window.requestAnimationFrame(()=>C()));return}let i=await new Promise((t,i)=>{w.detect(e).then(e=>{Array.isArray(e)&&e.length>0?t(e[0]):i({message:"No barcode detected"})}).catch(i)});if(!i?.rawValue)throw Error("No barcode value");console.log("✓ Barcode detected:",i.rawValue),window.cancelAnimationFrame(t),o&&(o.hidden=!0),r&&(r.hidden=!1),s&&(s.hidden=!0),k(200,860,.03),S(),await z(i.rawValue);return}catch{}f&&(t=window.requestAnimationFrame(()=>C()))}async function z(t){let e=await $(t);!function(t,e=""){u&&(m.value=t,p.value=e,g.value="1",u.showModal(),e?(g.focus(),g.select()):p.focus())}(t,e?.name||"")}async function x(){let t=m?.value,i=p?.value?.trim(),n=parseInt(g?.value)||1;if(t&&i)try{let o=await $(t);o?o.name!==i&&await _(t,{name:i}):await W(t,i),await (0,P.addToFridge)(e,t,i,n),u?.close(),G(`${i} lagt til!`,"success")}catch(t){G("Feil: "+t.message,"danger")}}i?.addEventListener("capture-photo:video-play",t=>{s.hidden=!1,function(t){if(!t||!s)return;let e=t.getBoundingClientRect();s.style.cssText=`width: ${Math.min(.8*e.width,280)}px; height: ${Math.min(.5*e.height,200)}px`}(b=t.detail.video||i.shadowRoot?.querySelector("video")),C();let e=i.getTrackSettings(),n=i.getTrackCapabilities(),o=document.getElementById("zoomLevel"),r=document.getElementById("zoomControls");if(e?.zoom&&n?.zoom){let t=n.zoom.min||1,a=n.zoom.max||10,s=e.zoom||1;r&&(r.hidden=!1),o&&(o.textContent=s),r?.addEventListener("click",e=>{let n=e.target.closest("button")?.dataset.action;"zoom-in"===n&&s<a&&(s+=.5),"zoom-out"===n&&s>t&&(s-=.5),o&&(o.textContent=s),i.zoom=s})}}),r?.addEventListener("click",()=>{r.hidden=!0,s.hidden=!1,n?.close(),f=!0,C()}),l?.addEventListener("click",()=>c?.showModal()),c?.addEventListener("click",t=>{t.target===t.currentTarget&&c.close()}),d?.addEventListener("change",t=>{let e={};d.querySelectorAll('input[type="checkbox"]').forEach(t=>{e[t.name]=t.checked}),q(e)}),h?.addEventListener("submit",async t=>{t.preventDefault(),await x()}),document.getElementById("skipProductBtn")?.addEventListener("click",()=>{u?.close()}),u?.addEventListener("click",t=>{t.target===t.currentTarget&&u.close()})}()}();
//# sourceMappingURL=scanner.ade05fc8.js.map
