function t(t,e,i,n){Object.defineProperty(t,e,{get:i,set:n,enumerable:!0,configurable:!0})}var e,i,n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o={},s={},a=n.parcelRequirea202;null==a&&((a=function(t){if(t in o)return o[t].exports;if(t in s){var e=s[t];delete s[t];var i={id:t,exports:{}};return o[t]=i,e.call(i.exports,i,i.exports),i.exports}var n=Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(t,e){s[t]=e},n.parcelRequirea202=a);var r=a.register;function l(t,e,i){if(!e.has(t))throw TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}function d(t,e){var i;return(i=l(t,e,"get")).get?i.get.call(t):i.value}function c(t,e){if(e.has(t))throw TypeError("Cannot initialize the same private elements twice on an object")}function u(t,e,i){c(t,e),e.set(t,i)}function h(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw TypeError("attempted to set read only private field");e.value=i}}(t,l(t,e,"set"),i),i}function m(t,e,i){if(!e.has(t))throw TypeError("attempted to get private field on non-instance");return i}function g(t,e){c(t,e),e.add(t)}r("kyEFX",function(e,i){t(e.exports,"register",function(){return n},function(t){return n=t}),t(e.exports,"resolve",function(){return o},function(t){return o=t});var n,o,s=new Map;n=function(t,e){for(var i=0;i<e.length-1;i+=2)s.set(e[i],{baseUrl:t,path:e[i+1]})},o=function(t){var e=s.get(t);if(null==e)throw Error("Could not resolve bundle with id "+t);return new URL(e.path,e.baseUrl).toString()}}),r("1OZCQ",function(t,e){var i=a("hffE7");t.exports=i("5JYMk").then(()=>a("aexh3"))}),r("hffE7",function(t,e){t.exports=function(t){return import(a("kyEFX").resolve(t))}}),a("kyEFX").register(new URL("",import.meta.url).toString(),JSON.parse('["fBh1y","scanner.27d85863.js","5JYMk","es.3ae9bc81.js","b67HE","index.50922028.js"]')),Object.defineProperty({},"ResizeObserverElement",{get:function(){return C},set:e,enumerable:!0,configurable:!0});const p=document.createElement("template"),f=String.raw;p.innerHTML=f`
  <style>:host { display: contents; }</style>
  <slot></slot>
`;var b=new WeakMap,v=new WeakMap,w=new WeakMap,y=new WeakSet,E=new WeakSet,k=new WeakMap,S=new WeakSet;class C extends HTMLElement{static get observedAttributes(){return["disabled"]}attributeChangedCallback(t,e,i){"disabled"===t&&e!==i&&(this.disabled?m(this,E,A).call(this):m(this,y,z).call(this))}connectedCallback(){m(this,S,x).call(this,"disabled"),"ResizeObserver"in window&&(h(this,v,new ResizeObserver(t=>{this.dispatchEvent(new CustomEvent("resize-observer:resize",{bubbles:!0,composed:!0,detail:{entries:t}}))})),this.disabled||m(this,y,z).call(this),d(this,b).addEventListener("slotchange",d(this,k)))}disconnectedCallback(){m(this,E,A).call(this),d(this,b).removeEventListener("slotchange",d(this,k))}get disabled(){return this.hasAttribute("disabled")}set disabled(t){t?this.setAttribute("disabled",""):this.removeAttribute("disabled")}static defineCustomElement(t="resize-observer"){"undefined"==typeof window||window.customElements.get(t)||window.customElements.define(t,C)}constructor(){super(),g(this,y),g(this,E),g(this,S),u(this,b,{writable:!0,value:void 0}),u(this,v,{writable:!0,value:void 0}),u(this,w,{writable:!0,value:void 0}),u(this,k,{writable:!0,value:()=>{this.disabled||m(this,y,z).call(this)}}),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(p.content.cloneNode(!0))),h(this,b,this.shadowRoot.querySelector("slot")),h(this,v,null),h(this,w,[])}}function z(){d(this,b)&&d(this,v)&&(d(this,w).forEach(t=>d(this,v).unobserve(t)),h(this,w,[]),d(this,b).assignedElements().forEach(t=>{d(this,v).observe(t),d(this,w).push(t)}))}function A(){d(this,v)&&d(this,v).disconnect()}function x(t){if(Object.prototype.hasOwnProperty.call(this,t)){let e=this[t];delete this[t],this[t]=e}}C.defineCustomElement(),Object.defineProperty({},"CapturePhoto",{get:function(){return B},set:void 0,enumerable:!0,configurable:!0});let T=(t,e,i)=>(Number.isNaN(e)&&(e=0),Number.isNaN(i)&&(i=0),Math.min(Math.max(t,Math.min(e,i)),Math.max(e,i))),L="capture-photo",M=`
  :host {
    display: block;
    box-sizing: border-box;
  }

  :host *,
  :host *::before,
  :host *::after {
    box-sizing: inherit;
  }

  :host([hidden]),
  [hidden],
  ::slotted([hidden]) {
    display: none;
  }

  video {
    display: block;
  }

  #output:empty {
    display: none;
  }
`,R=document.createElement("template");R.innerHTML=`
  <style>${M}</style>

  <video part="video" playsinline></video>

  <canvas hidden></canvas>

  <div part="actions-container">
    <slot name="capture-button">
      <button part="capture-button" type="button">
        <slot name="capture-button-content">Capture photo</slot>
      </button>
    </slot>

    <slot name="facing-mode-button" hidden>
      <button part="facing-mode-button" type="button">
        <slot name="facing-mode-button-content">Toggle facing mode</slot>
      </button>
    </slot>

    <slot name="actions"></slot>
  </div>

  <slot></slot>

  <div part="output-container" id="output"></div>
`;class B extends HTMLElement{#t={};#e=null;#i=null;#n=null;#o=null;#s=null;#a=null;#r=null;#l=null;constructor(){super(),this.#t=this.getSupportedConstraints(),this.shadowRoot||this.attachShadow({mode:"open"}).appendChild(R.content.cloneNode(!0))}static get observedAttributes(){return["no-image","facing-mode","camera-resolution","pan","tilt","zoom"]}attributeChangedCallback(t,e,i){if(!this.isConnected)return;let n=this.getTrackCapabilities(),o=this.getTrackSettings();if("no-image"===t&&e!==i&&this.#d(),"facing-mode"===t&&e!==i&&"facingMode"in this.#t){let t=["user","environment"].includes(this.facingMode||"");"facingMode"in o&&t&&(this.stopVideoStream(),this.startVideoStream())}if("camera-resolution"===t&&e!==i&&"string"==typeof this.cameraResolution&&this.cameraResolution.trim().length>0){let[t=0,e=0]=this.cameraResolution.split("x").map(t=>Number(t));if(t>0&&e>0&&"width"in n&&"height"in n){let i=!!(n.width?.min&&n.width?.max)&&t>=n?.width?.min&&t<=n?.width?.max,s=!!(n.height?.min&&n.height?.max)&&e>=n?.height?.min&&e<=n?.height?.max;"width"in o&&"height"in o&&i&&s&&(this.stopVideoStream(),this.startVideoStream())}}if("pan"===t&&e!==i&&"pan"in this.#t){let t=!!("pan"in n&&n.pan?.min&&n.pan?.max)&&this.pan>=n.pan.min&&this.pan<=n.pan.max;"pan"in o&&"number"==typeof this.pan&&t&&this.#c("pan",this.pan)}if("tilt"===t&&e!==i&&"tilt"in this.#t){let t=!!("tilt"in n&&n.tilt?.min&&n.tilt?.max)&&this.tilt>=n.tilt.min&&this.tilt<=n.tilt.max;"tilt"in o&&"number"==typeof this.tilt&&t&&this.#c("tilt",this.tilt)}if("zoom"===t&&e!==i&&"zoom"in this.#t){let t=!!("zoom"in n&&n.zoom?.min&&n.zoom?.max)&&this.zoom>=n.zoom.min&&this.zoom<=n.zoom.max;"zoom"in o&&"number"==typeof this.zoom&&t&&this.#c("zoom",this.zoom)}}connectedCallback(){if(this.#u("autpoPlay"),this.#u("noImage"),this.#u("facingMode"),this.#u("cameraResolution"),this.#u("pan"),this.#u("tilt"),this.#u("zoom"),this.#u("calculateFileSize"),this.#i=this.shadowRoot?.querySelector("canvas")||null,this.#n=this.shadowRoot?.getElementById("output")||null,this.#o=this.shadowRoot?.querySelector("video")||null,this.#s=this.shadowRoot?.querySelector('slot[name="capture-button"]')||null,this.#a=this.#h(),this.#r=this.shadowRoot?.querySelector('slot[name="facing-mode-button"]')||null,this.#l=this.#m(),this.#o?.addEventListener("loadedmetadata",this.#g),this.#s?.addEventListener("slotchange",this.#p),this.#a?.addEventListener("click",this.#f),this.#r?.addEventListener("slotchange",this.#b),this.#l?.addEventListener("click",this.#v),!B.isSupported())return this.dispatchEvent(new CustomEvent(`${L}:error`,{bubbles:!0,composed:!0,detail:{error:{name:"NotSupportedError",message:"Not supported"}}}));this.autoPlay&&this.startVideoStream()}disconnectedCallback(){this.stopVideoStream(),this.#l?.removeEventListener("click",this.#v),this.#a?.removeEventListener("click",this.#f),this.#o?.removeEventListener("canplay",this.#g),this.#s?.removeEventListener("slotchange",this.#p),this.#r?.removeEventListener("slotchange",this.#b)}get autoPlay(){return this.hasAttribute("auto-play")}set autoPlay(t){this.toggleAttribute("auto-play",!!t)}get noImage(){return this.hasAttribute("no-image")}set noImage(t){this.toggleAttribute("no-image",!!t)}get facingMode(){return this.getAttribute("facing-mode")||"user"}set facingMode(t){this.setAttribute("facing-mode",t)}get cameraResolution(){return this.getAttribute("camera-resolution")||""}set cameraResolution(t){this.setAttribute("camera-resolution",t)}get pan(){return Number(this.getAttribute("pan"))||0}set pan(t){this.setAttribute("pan",null!=t?t.toString():t)}get tilt(){return Number(this.getAttribute("tilt"))||0}set tilt(t){this.setAttribute("tilt",null!=t?t.toString():t)}get zoom(){return Number(this.getAttribute("zoom"))||1}set zoom(t){this.setAttribute("zoom",null!=t?t.toString():t)}get loading(){return this.hasAttribute("loading")}get calculateFileSize(){return this.hasAttribute("calculate-file-size")}set calculateFileSize(t){this.toggleAttribute("calculate-file-size",!!t)}#v=t=>{t.preventDefault(),this.loading||(this.facingMode="user"!==this.facingMode&&this.facingMode?"user":"environment")};#f=t=>{t.preventDefault(),this.capture()};#g=t=>{let e=t.target;e.play().then(()=>{this.dispatchEvent(new CustomEvent(`${L}:video-play`,{bubbles:!0,composed:!0,detail:{video:e}}))}).catch(t=>{this.dispatchEvent(new CustomEvent(`${L}:error`,{bubbles:!0,composed:!0,detail:{error:t}}))}).finally(()=>{this.removeAttribute("loading")})};#d(){this.#n&&Array.from(this.#n.childNodes).forEach(t=>t.remove())}#c(t,e){if(!this.#e||!t||!e)return;let[i]=this.#e.getVideoTracks(),n=this.getTrackCapabilities();t in this.getTrackSettings()&&i.applyConstraints({advanced:[{[t]:T(Number(e),n[t]?.min||1,n[t]?.max||1)}]})}#p=t=>{t.target?.name==="capture-button"&&(this.#a?.removeEventListener("click",this.#f),this.#a=this.#h(),this.#a&&(this.#a.addEventListener("click",this.#f),"BUTTON"===this.#a.nodeName||this.#a.hasAttribute("role")||this.#a.setAttribute("role","button")))};#b=t=>{t.target?.name==="facing-mode-button"&&(this.#l?.removeEventListener("click",this.#v),this.#l=this.#m(),this.#l&&(this.#l.addEventListener("click",this.#v),"BUTTON"===this.#l.nodeName||this.#l.hasAttribute("role")||this.#l.setAttribute("role","button")))};#m(){return this.#r&&this.#r.assignedElements({flatten:!0}).find(t=>"BUTTON"===t.nodeName||"facing-mode-button"===t.getAttribute("slot"))||null}#h(){return this.#s&&this.#s.assignedElements({flatten:!0}).find(t=>"BUTTON"===t.nodeName||"capture-button"===t.getAttribute("slot"))||null}#u(t){if(Object.prototype.hasOwnProperty.call(this,t)){let e=this[t];delete this[t],this[t]=e}}async startVideoStream(){if(!B.isSupported()||this.#e)return;this.setAttribute("loading","");let t={video:{facingMode:{ideal:this.facingMode||"user"},pan:!0,tilt:!0,zoom:!0},audio:!1};if("string"==typeof this.cameraResolution&&this.cameraResolution.trim().length>0){let[e=0,i=0]=this.cameraResolution.split("x").map(t=>Number(t));e>0&&i>0&&(t.video.width=e,t.video.height=i)}try{this.#e=await navigator.mediaDevices.getUserMedia(t),this.#o&&(this.#o.srcObject=this.#e),this.#c("pan",this.pan),this.#c("tilt",this.tilt),this.#c("zoom",this.zoom);let e=this.getTrackSettings();"facingMode"in e&&this.#r&&(this.#r.hidden=!1)}catch(t){this.dispatchEvent(new CustomEvent(`${L}:error`,{bubbles:!0,composed:!0,detail:{error:t}}))}finally{this.removeAttribute("loading")}}stopVideoStream(){if(!this.#o||!this.#e)return;let[t]=this.#e.getVideoTracks();t?.stop(),this.#o.srcObject=null,this.#e=null}async capture(){if(!this.loading&&this.#i&&this.#o)try{let t=this.#i.getContext("2d"),e=this.#o.videoWidth,i=this.#o.videoHeight;this.#i.width=e,this.#i.height=i,t?.drawImage(this.#o,0,0,e,i);let n=this.#i.toDataURL("image/png");if("string"==typeof n&&n.includes("data:image")){if(!this.noImage){let t=new Image;t.src=n,t.width=e,t.height=i,t.setAttribute("part","output-image"),this.#d(),this.#n?.appendChild(t)}let t={dataURI:n,width:e,height:i};if(this.calculateFileSize)try{let e=await fetch(n),i=(await e.blob()).size;i&&(t.size=i)}catch(t){}this.dispatchEvent(new CustomEvent(`${L}:success`,{bubbles:!0,composed:!0,detail:t}))}}catch(t){this.dispatchEvent(new CustomEvent(`${L}:error`,{bubbles:!0,composed:!0,detail:{error:t}}))}}getSupportedConstraints(){return B.isSupported()&&navigator.mediaDevices.getSupportedConstraints()||{}}getTrackCapabilities(){if(!this.#e)return{};let[t]=this.#e.getVideoTracks();return t&&"function"==typeof t.getCapabilities&&t.getCapabilities()||{}}getTrackSettings(){if(!this.#e)return{};let[t]=this.#e.getVideoTracks();return t&&"function"==typeof t.getSettings&&t.getSettings()||{}}static isSupported(){return!!navigator.mediaDevices?.getUserMedia}static defineCustomElement(t=L){"undefined"==typeof window||window.customElements.get(t)||window.customElements.define(t,B)}}function N(t){return new Promise(function(e,i){t.oncomplete=t.onsuccess=function(){return e(t.result)},t.onabort=t.onerror=function(){return i(t.error)}})}function I(){if(!i){var t,e,n;t="keyval",(e=indexedDB.open("keyval-store")).onupgradeneeded=function(){return e.result.createObjectStore(t)},n=N(e),i=function(e,i){return n.then(function(n){return i(n.transaction(t,e).objectStore(t))})}}return i}B.defineCustomElement();const O="barcode-scanner/",F="settings",D=async t=>{try{return{value:await function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I();return e("readonly",function(e){return N(e.get(t))})}(t),error:void 0}}catch(t){return{value:void 0,error:t}}},j=async(t,e)=>{try{return await function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:I();return i("readwrite",function(i){return i.put(e,t),N(i.transaction)})}(t,e),{error:void 0}}catch(t){return{error:t}}},U=async()=>D(O+F),q=async t=>j(O+F,t);var V=a("ccbGL"),P=a("1MkCa"),H=a("ftYLF"),V=a("ccbGL");const $=async t=>{let e=await (0,H.getDoc)((0,H.doc)(V.db,"products",t));return e.exists()?{id:e.id,...e.data()}:null},W=async(t,e)=>{let i="string"==typeof e?e:e?.name,n={barcode:t,name:i,description:"object"==typeof e&&e?.description||"",imageUrl:"object"==typeof e&&e?.imageUrl||null,category:"object"==typeof e&&e?.category||"uncategorized",createdAt:(0,H.serverTimestamp)(),updatedAt:(0,H.serverTimestamp)()};return await (0,H.setDoc)((0,H.doc)(V.db,"products",t),n),n},_=async(t,e)=>{let i=(0,H.doc)(V.db,"products",t);await (0,H.updateDoc)(i,{...e,updatedAt:(0,H.serverTimestamp)()})};function G(t,e="success"){let i=document.getElementById("toastContainer");if(!i)return;let n=document.createElement("div");n.className=`toast ${e}`,n.textContent=t,i.appendChild(n),setTimeout(()=>n.remove(),3e3)}!async function(){let t;if(!(0,P.getCurrentFridgeCode)()){window.location.href="index.html";return}let e=document.querySelector("capture-photo"),i=document.getElementById("cameraResults"),n=document.getElementById("scanInstructions"),o=document.getElementById("scanBtn"),s=document.getElementById("scanFrame"),r=document.getElementById("settingsBtn"),l=document.getElementById("settingsDialog"),d=document.forms["settings-form"],c=document.getElementById("productDialog"),u=document.getElementById("productForm"),h=document.getElementById("productBarcode"),m=document.getElementById("productName"),g=document.getElementById("productQuantity"),p=!0,f=null;try{await (0,V.initializeFirebase)(),console.log("Firebase ready")}catch(t){console.error("Firebase init error:",t)}if(!("BarcodeDetector"in window))try{await a("1OZCQ"),console.log("Using BarcodeDetector polyfill.")}catch(t){return G("Strekkodeskanning støttes ikke i denne nettleseren.","danger")}let b=await window.BarcodeDetector.getSupportedFormats(),v=new window.BarcodeDetector({formats:b}),{value:w={beep:!0,vibrate:!0}}=await U();Object.entries(w).forEach(([t,e])=>{let i=d?.querySelector(`[name="${t}"]`);i&&(i.checked=e)});let y=()=>(f||(f=e?.shadowRoot?.querySelector("video")),f),E=null,k=()=>(E||(E=new(window.AudioContext||window.webkitAudioContext)),"suspended"===E.state&&E.resume(),E),S=async(t=200,e=860,i=.03)=>{let{value:n}=await U();if(n?.beep!==!1)try{let n=k(),o=n.createOscillator(),s=n.createGain();o.connect(s),s.connect(n.destination),s.gain.value=i,o.frequency.value=e,o.type="square",o.start(n.currentTime),o.stop(n.currentTime+t/1e3)}catch(t){console.log("Beep failed:",t)}};async function C(t=100){let{value:e}=await U();if(e?.vibrate!==!1&&"function"==typeof navigator.vibrate)try{navigator.vibrate(t)}catch(t){console.log("Vibrate failed:",t)}}async function z(){n&&(n.hidden=!1);try{let e=y();if(!e||e.readyState<2){p&&(t=window.requestAnimationFrame(()=>z()));return}let i=await new Promise((t,i)=>{v.detect(e).then(e=>{Array.isArray(e)&&e.length>0?t(e[0]):i({message:"No barcode detected"})}).catch(i)});if(!i?.rawValue)throw Error("No barcode value");console.log("✓ Barcode detected:",i.rawValue),window.cancelAnimationFrame(t),n&&(n.hidden=!0),o&&(o.hidden=!1),s&&(s.hidden=!0),S(200,860,.03),C(),await A(i.rawValue);return}catch{}p&&(t=window.requestAnimationFrame(()=>z()))}async function A(t){let e=await $(t);!function(t,e=""){c&&(h.value=t,m.value=e,g.value="1",c.showModal(),e?(g.focus(),g.select()):m.focus())}(t,e?.name||"")}async function x(){let t=h?.value,e=m?.value?.trim(),i=parseInt(g?.value)||1;if(t&&e)try{let n=await $(t);n?n.name!==e&&await _(t,{name:e}):await W(t,e),await (0,P.addToFridge)(t,{name:e},i),c?.close(),G(`${e} lagt til!`,"success")}catch(t){G("Feil: "+t.message,"danger")}}e?.addEventListener("capture-photo:video-play",t=>{s.hidden=!1,function(t){if(!t||!s)return;let e=t.getBoundingClientRect();s.style.cssText=`width: ${Math.min(.8*e.width,280)}px; height: ${Math.min(.5*e.height,200)}px`}(f=t.detail.video||e.shadowRoot?.querySelector("video")),z();let i=e.getTrackSettings(),n=e.getTrackCapabilities(),o=document.getElementById("zoomLevel"),a=document.getElementById("zoomControls");if(i?.zoom&&n?.zoom){let t=n.zoom.min||1,s=n.zoom.max||10,r=i.zoom||1;a&&(a.hidden=!1),o&&(o.textContent=r),a?.addEventListener("click",i=>{let n=i.target.closest("button")?.dataset.action;"zoom-in"===n&&r<s&&(r+=.5),"zoom-out"===n&&r>t&&(r-=.5),o&&(o.textContent=r),e.zoom=r})}}),o?.addEventListener("click",()=>{o.hidden=!0,s.hidden=!1,i?.close(),p=!0,z()}),r?.addEventListener("click",()=>l?.showModal()),l?.addEventListener("click",t=>{t.target===t.currentTarget&&l.close()}),d?.addEventListener("change",t=>{let e={};d.querySelectorAll('input[type="checkbox"]').forEach(t=>{e[t.name]=t.checked}),q(e)}),u?.addEventListener("submit",async t=>{t.preventDefault(),await x()}),document.getElementById("skipProductBtn")?.addEventListener("click",()=>{c?.close()}),c?.addEventListener("click",t=>{t.target===t.currentTarget&&c.close()})}();
//# sourceMappingURL=scanner.27d85863.js.map
